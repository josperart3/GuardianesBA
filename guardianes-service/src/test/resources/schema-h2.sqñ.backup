-- Schema creation for H2 test database
-- This script ensures all tables are created correctly for tests

-- Create sequences for entities that use GenerationType.IDENTITY
CREATE SEQUENCE IF NOT EXISTS hibernate_sequence START WITH 1;
CREATE SEQUENCE IF NOT EXISTS Rol_id_seq START WITH 1;
CREATE SEQUENCE IF NOT EXISTS Doctor_id_seq START WITH 1;
CREATE SEQUENCE IF NOT EXISTS shift_id_seq START WITH 1;
CREATE SEQUENCE IF NOT EXISTS shift_assignment_id_seq START WITH 1;
CREATE SEQUENCE IF NOT EXISTS AllowedShift_id_seq START WITH 1;

-- Create tables explicitly to avoid H2 metadata issues
CREATE TABLE IF NOT EXISTS cyclechange (
    day_configuration_day INTEGER NOT NULL,
    day_configuration_calendar_month INTEGER NOT NULL,
    day_configuration_calendar_year INTEGER NOT NULL,
    cycle_giver_id BIGINT,
    cycle_receiver_id BIGINT,
    PRIMARY KEY (day_configuration_day, day_configuration_calendar_month, day_configuration_calendar_year)
);

CREATE TABLE IF NOT EXISTS scheduleday (
    day INTEGER NOT NULL,
    month INTEGER NOT NULL,
    year INTEGER NOT NULL,
    num_consultations INTEGER,
    num_shifts INTEGER,
    PRIMARY KEY (day, month, year)
);

CREATE TABLE IF NOT EXISTS schedule_day_cfg (
    sched_calendar_month INTEGER NOT NULL,
    sched_calendar_year INTEGER NOT NULL,
    dc_day INTEGER NOT NULL,
    dc_calendar_month INTEGER NOT NULL,
    dc_calendar_year INTEGER NOT NULL,
    PRIMARY KEY (sched_calendar_month, sched_calendar_year, dc_day, dc_calendar_month, dc_calendar_year)
);

CREATE TABLE IF NOT EXISTS scheduleday_consultations (
    schedule_day_day INTEGER NOT NULL,
    schedule_day_month INTEGER NOT NULL,
    schedule_day_year INTEGER NOT NULL,
    consultations_id BIGINT NOT NULL,
    PRIMARY KEY (schedule_day_day, schedule_day_month, schedule_day_year, consultations_id)
);

CREATE TABLE IF NOT EXISTS scheduleday_cycle (
    schedule_day_day INTEGER NOT NULL,
    schedule_day_month INTEGER NOT NULL,
    schedule_day_year INTEGER NOT NULL,
    cycle_id BIGINT NOT NULL,
    PRIMARY KEY (schedule_day_day, schedule_day_month, schedule_day_year, cycle_id)
);

CREATE TABLE IF NOT EXISTS scheduleday_shifts (
    schedule_day_day INTEGER NOT NULL,
    schedule_day_month INTEGER NOT NULL,
    schedule_day_year INTEGER NOT NULL,
    shifts_id BIGINT NOT NULL,
    PRIMARY KEY (schedule_day_day, schedule_day_month, schedule_day_year, shifts_id)
);